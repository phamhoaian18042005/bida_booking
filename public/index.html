<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>71 Billiards - Đẳng cấp Bida</title>
    <!-- Link Icon FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- 1. Header / Navbar -->
    <header class="header">
        <nav class="navbar">
            <a href="#home" class="active">Trang chủ</a>
            <a href="#intro">Giới thiệu</a>
            <a href="#services">Dịch vụ</a>
            <a href="#branches">Chi nhánh</a>
            <a href="#footer">Liên hệ</a>
            
            <!-- Phần này JS sẽ tự điền: Đặt lịch, Lịch sử, Đăng nhập -->
            <span id="nav-dynamic-area">
                <a href="booking.html" class="highlight">ĐẶT LỊCH</a>
                <a href="login.html" id="btn-login-nav" style="border:1px solid white; border-radius:5px; padding:6px 12px; margin-left:10px">ĐĂNG NHẬP</a>
            </span>
        </nav>

        <div class="logo">
            <div class="logo-text">
                <i class="fa-solid fa-crown"></i> 71<br><span>BILLIARDS</span>
            </div>
        </div>
    </header>

    <!-- 2. Hero Section -->
    <section id="home" class="hero-section">
        <div class="hero-content">
            <h1>WHERE PASSION MEETS PRECISION</h1>
            <p>Trải nghiệm không gian Bida đẳng cấp nhất Việt Nam</p>
            <a href="#branches" class="btn-main">CHỌN CHI NHÁNH NGAY</a>
        </div>
    </section>

    <!-- 3. Giới thiệu -->
    <section id="intro" class="section-padding container">
        <div class="intro-grid">
            <div class="intro-text">
                <h2 class="section-title">VỀ CHÚNG TÔI 71 Billiards</h2>
                <p>71 Billiards không chỉ là nơi chơi bida, mà là không gian giải trí đẳng cấp dành cho những cơ thủ đam mê sự hoàn hảo.</p>
                <ul class="feature-list">
                    <li><i class="fa-solid fa-check"></i> Bàn đạt chuẩn thi đấu Quốc tế</li>
                    <li><i class="fa-solid fa-check"></i> Bóng Aramith Black nhập khẩu</li>
                    <li><i class="fa-solid fa-check"></i> Menu đồ uống đa dạng & tinh tế</li>
                </ul>
            </div>
            <div class="intro-img">
                <img src="images/intro.jpg" alt="Không gian 71 Billiards" onerror="this.src='https://source.unsplash.com/600x400/?billiards'">
            </div>
        </div>
    </section>

    <!-- 4. Dịch vụ (Popup Functionality) -->
    <section id="services" class="section-padding bg-darker">
        <div class="container">
            <h2 class="section-title center">DỊCH VỤ CỦA CHÚNG TÔI</h2>
            <div class="service-grid">
                
                <div class="service-card" onclick="openServiceModal('pool')">
                    <i class="fa-solid fa-layer-group"></i>
                    <h3>Bàn Lỗ (Pool)</h3>
                    <p>Hệ thống bàn Pool Rasson & Aplus đời mới nhất.</p>
                </div>

                <div class="service-card" onclick="openServiceModal('carom')">
                    <i class="fa-solid fa-bullseye"></i>
                    <h3>Bàn Phăng (France)</h3>
                    <p>Bàn Hollywood & Gabriels chuẩn thi đấu Carom 3 băng.</p>
                </div>

                <div class="service-card" onclick="openServiceModal('menu')">
                    <i class="fa-solid fa-martini-glass-citrus"></i>
                    <h3>Coffee & Bar</h3>
                    <p>Phục vụ các loại Cocktail, Cafe và đồ ăn nhẹ thượng hạng.</p>
                </div>

                <div class="service-card" onclick="openServiceModal('tournament')">
                    <i class="fa-solid fa-trophy"></i>
                    <h3>Giải Đấu</h3>
                    <p>Tổ chức các giải đấu chuyên nghiệp và bán chuyên hàng tháng.</p>
                </div>

            </div>
        </div>
    </section>

    <!-- === POPUP MODAL === -->
    <div id="service-modal" class="custom-modal">
        <div class="modal-content modal-large">
            <span class="close-btn" onclick="closeServiceModal()">&times;</span>
            <div id="modal-body-content"></div>
        </div>
    </div>

    <!-- 5. Chi Nhánh -->
    <section id="branches" class="section-padding container">
        <h2 class="section-title center">HỆ THỐNG CHI NHÁNH</h2>
        <div class="branch-grid">
            <div class="branch-card">
                <div class="branch-img"><img src="images/branch1.jpg" alt="CN Quận 1" onerror="this.src='https://images.unsplash.com/photo-1628173499424-3406f5236c53?w=500'"><span class="badge">Premium</span></div>
                <div class="branch-info">
                    <h3>71 Billiards QUẬN 1</h3>
                    <p><i class="fa-solid fa-location-dot"></i> 123 Nguyễn Huệ, Quận 1</p>
                    <a href="booking.html?branch=1" class="btn-border">ĐẶT BÀN NGAY</a>
                </div>
            </div>
            <div class="branch-card">
                <div class="branch-img"><img src="images/branch2.jpg" alt="CN Quận 7" onerror="this.src='https://images.unsplash.com/photo-1577709865036-cc0f6a15db4a?w=500'"><span class="badge">Standard</span></div>
                <div class="branch-info">
                    <h3>71 Billiards QUẬN 7</h3>
                    <p><i class="fa-solid fa-location-dot"></i> 45 Nguyễn Thị Thập, Quận 7</p>
                    <a href="booking.html?branch=2" class="btn-border">ĐẶT BÀN NGAY</a>
                </div>
            </div>
        </div>
    </section>

    <!-- 6. Footer -->
    <footer id="footer" class="footer-design">
        <div class="footer-overlay">
            <div class="container footer-layout">
                <div class="footer-left">
                    <h2 class="footer-brand">71<br>BILLIARDS</h2>
                    <div class="contact-list">
                        <p>Trụ sở chính: 123 Nguyễn Huệ, Quận 1, TP.HCM</p>
                        <p>Email: admin@gmail.com</p>
                    </div>
                </div>
                <div class="footer-center">
                    <div class="logo-circle"><div class="inner-logo"><i class="fa-solid fa-crown"></i><span>71</span></div></div>
                </div>
            </div>
        </div>
    </footer>

    <!-- SIDEBAR + CHATBOT -->
    <div class="floating-sidebar">
        <a href="booking.html" class="float-item btn-booking"><div class="icon-box"><i class="fa-regular fa-calendar-days"></i></div><div class="ripple-ring"></div></a>
        <a href="javascript:void(0)" class="float-item btn-mess" onclick="toggleChat()"><div class="icon-box"><i class="fa-brands fa-facebook-messenger"></i></div></a>
        <div style="height: 20px;"></div>
        <a href="#home" class="scroll-top-square" id="scrollTopBtn"><i class="fa-solid fa-chevron-up"></i></a>
    </div>

    <div id="chat-widget" class="chat-widget">
        <div class="chat-header">
            <div class="chat-info"><span class="chat-title">71 BILLIARDS CSKH</span></div>
            <button class="chat-close" onclick="toggleChat()">&times;</button>
        </div>
        <div id="chat-body" class="chat-body">
            <div class="message bot-msg">Xin chào! Bạn cần giúp gì không?</div>
        </div>
        <div class="chat-footer">
            <input type="text" id="chat-input" placeholder="Nhập tin nhắn..." onkeypress="handleKeyPress(event)">
            <button class="btn-send" onclick="sendMessage()"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // 1. SCROLL TOP
        window.addEventListener('scroll', function() {
            var scrollBtn = document.getElementById('scrollTopBtn');
            if (window.scrollY > 300) scrollBtn.classList.add('show');
            else scrollBtn.classList.remove('show');
        });

        // 2. CHECK LOGIN (ẨN/HIỆN NÚT)
        document.addEventListener('DOMContentLoaded', () => {
            const userStr = localStorage.getItem('user_info') || localStorage.getItem('user');
            const navArea = document.getElementById('nav-dynamic-area');

            if (userStr) {
                const user = JSON.parse(userStr);
                let adminLink = user.role === 'admin' ? `<a href="admin.html" style="color:#e74c3c;font-weight:bold;margin-right:10px">QUẢN TRỊ</a>` : '';
                
                navArea.innerHTML = `
                    <a href="booking.html" class="highlight">ĐẶT LỊCH</a>
                    <a href="history.html" style="color:white; margin-right:10px">LỊCH SỬ</a>
                    ${adminLink}
                    <a href="#" onclick="doLogout()" style="color:#aaa; border:1px solid #aaa; padding:5px 10px; border-radius:5px; font-size:12px;">LOGOUT</a>
                `;
            }
        });
        function doLogout() {
            localStorage.removeItem('user_info'); localStorage.removeItem('user'); location.reload();
        }

        // 3. POPUP SƠ ĐỒ BÀN (CÓ CHECK STATUS BÀN)
        async function openServiceModal(type) {
            const modal = document.getElementById('service-modal');
            const content = document.getElementById('modal-body-content');

            if(type === 'menu') {
                content.innerHTML = `<h2 class="map-title">MENU</h2><div class="menu-list">... Nội dung menu ...</div>`;
                modal.style.display = 'flex';
                return;
            } 
            
            if(type === 'pool' || type === 'carom') {
                content.innerHTML = '<h3 style="color:white;text-align:center">Đang tải sơ đồ...</h3>';
                modal.style.display = 'flex';
                
                try {
                    const res = await fetch('/api/tables'); // Gọi API lấy tất cả bàn
                    const allTables = await res.json();
                    
                    let htmlGrid = '<div class="map-grid">';
                    const targetType = type==='pool' ? 'Pool' : 'Phăng';
                    
                    allTables.forEach(t => {
                        // Lọc loại bàn
                        if(t.type.includes(targetType) || (type==='carom' && t.type.includes('France')) || (type==='pool' && t.type.includes('Lỗ'))) {
                            
                            // Check bàn bận
                            let statusClass = "table-node"; 
                            let statusText = "";
                            if(t.is_busy > 0) {
                                statusClass += " busy-node"; // Cần thêm CSS busy-node nền đỏ
                                statusText = "<br><span style='color:yellow;font-size:10px'>(BẬN)</span>";
                            }
                            
                            htmlGrid += `<a href="booking.html?table_id=${t.id}&branch=${t.branch_id}" class="${statusClass}"><strong>${t.name}</strong><small>CN ${t.branch_id}</small>${statusText}</a>`;
                        }
                    });
                    htmlGrid += '</div>';
                    
                    content.innerHTML = `<h2 class="map-title">SƠ ĐỒ BÀN ${targetType.toUpperCase()}</h2>` + htmlGrid;
                
                } catch(e) { content.innerHTML="Lỗi tải bàn"; }
            }
        }
        function closeServiceModal() { document.getElementById('service-modal').style.display='none'; }

        // 4. CHATBOT & UTILS
        function toggleChat() { 
            const chat = document.getElementById('chat-widget');
            chat.style.display = chat.style.display==='block' ? 'none' : 'block';
        }
        function handleKeyPress(e) { if(e.key==='Enter') sendMessage(); }
        function sendMessage() {
            const inp = document.getElementById('chat-input');
            const msg = inp.value.trim();
            if(!msg) return;
            // appendMessage(msg, 'user-msg'); ... (Code chat cũ)
            // appendMessage(getBotReply(msg), 'bot-msg');
            inp.value = '';
        }
    </script>
</body>
</html>